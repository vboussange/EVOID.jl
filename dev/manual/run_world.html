<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Run the World · EvoId.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="EvoId.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">EvoId.jl</span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="agent.html">Agent</a></li><li><a class="tocitem" href="space.html">Space</a></li><li><a class="tocitem" href="world.html">World</a></li><li class="is-active"><a class="tocitem" href="run_world.html">Run the World</a></li><li><a class="tocitem" href="plots.html">Plotting</a></li><li><a class="tocitem" href="diversity.html">Metrics</a></li><li><a class="tocitem" href="utils.html">Utils</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/changing_environment.html">Changing environments</a></li><li><a class="tocitem" href="../examples/delta_competition_example.html">A first model of meta population</a></li><li><a class="tocitem" href="../examples/dynamic_graphs.html">Dynamic graph</a></li><li><a class="tocitem" href="../examples/genetic_structure.html">Modelling agents with a genetic structure</a></li><li><a class="tocitem" href="../examples/gradient.html">Environmental Gradient</a></li><li><a class="tocitem" href="../examples/sympatric_speciation.html">Modelling Sympatric speciation</a></li></ul></li><li><span class="tocitem">Developping</span><ul><li><a class="tocitem" href="../dev/notes.html">Developping the code</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="run_world.html">Run the World</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="run_world.html">Run the World</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/vboussange/EvoId.jl/blob/master/docs/src/manual/run_world.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Run-the-World"><a class="docs-heading-anchor" href="#Run-the-World">Run the World</a><a id="Run-the-World-1"></a><a class="docs-heading-anchor-permalink" href="#Run-the-World" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="EvoId.run!" href="#EvoId.run!"><code>EvoId.run!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">run!(w, alg, tend, b, d; dt_saving=nothing, cb=(names = String[],agg =nothing))</code></pre><p>Run <code>w</code> with algorithm <code>alg</code>, until <code>tend</code> is reached. User needs to provide <code>b</code> the birth function, which takes as arguments <code>X,t</code>, and provide <code>d</code> the death function, with arguments <code>X,Y,t</code>. The run stops if the number of agents reaches<code>p[&quot;NMax&quot;]</code>, where <code>p</code> is the parameter dictionary in the world <code>w</code>.</p><p>Returns a <code>Simulation</code> object. It is a container for snapshots of the world at every <code>dt_saving</code>  time steps. It renders post processing easier, through dedicated methods to obtain time series of quantities.</p><p><strong>Keyword arguments</strong></p><ul><li>if <code>dt_saving</code> specified, world is saved every time steps.</li></ul><p>If <code>dt_saving</code> not specified, <code>sim</code> contains an array of two elements, first corresponding to initial conditions and last corresponding to world in the last time step.</p><ul><li>if <code>t_saving_cb</code> specified, callbacks are computed at each steps time specified in the array.</li></ul><p>This functionality is as of now only compatible with <code>dt_saving</code> not specified.</p><ul><li><code>cb</code> correspond to callbacks function. Callbacks can be used </li></ul><p>to extract properties of the world at each <code>dt_saving</code> time steps of your simulation.</p><p><strong>Constructing the callbacks</strong></p><p>A callback has to be of the form</p><pre><code class="language-julia">cb = (names = String[], agg = Function[])</code></pre><p>It is a tuple, with first value corresponding to the names of the aggregate properties of the world. The second correspond to the aggregation functions.</p><p>We provide here an example on how to extract the <span>$\gamma$</span> diversity of a simulation biological population.  <span>$\gamma$</span>` diversity can be calculated as the variance of the trait distribution of the population. Here is how we write the function</p><pre><code class="language-julia">cb = (names = [&quot;gamma_div&quot;], agg = Function[w -&gt; var((get_x(w,1)))])</code></pre><p><strong>Example</strong></p><pre><code class="language-julia">myspace = (RealSpace{1,Float64}(),)
sigma_K = .9;
sigma_a = .7;
K0 = 1000;
b(X) = gaussian(X[1],0.,sigma_K)
d(X,Y) = gaussian(X[1],Y[1],sigma_a)/K0
D = (1e-2,)
mu = [.1]
NMax = 10000
tend = 1.5
p = Dict{String,Any}();@pack! p = D,mu,NMax

myagents = [Agent(myspace,(0,),ancestors=true,rates=true) for i in 1:K0]
w0 = World(myagents, myspace, p, 0.)
w1 = copy(w0)
sim = run!(w1,Gillepsie(),tend,b,d,cb=cb,dt_saving = .1)</code></pre><p><strong>Accessing the callbacks</strong></p><p>You can easily access the properties, using <code>sim</code> as you would for a usual <code>Dictionary</code>.</p><pre><code class="language-julia">using Plots
plot(get_tspan(sim),sim[&quot;gamma_div&quot;])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/vboussange/EvoId.jl/blob/e1dfc19397e6968f72727732d7b904a3cc4c6f8a/src/runworld.jl#L1-L68">source</a></section></article><p>For now three algorithms</p><article class="docstring"><header><a class="docstring-binding" id="EvoId.Gillepsie" href="#EvoId.Gillepsie"><code>EvoId.Gillepsie</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct Gillepsie &lt;: EvoId.AbstractAlg</code></pre><p>Gillespie algorithm.</p><p>Denote by <span>$b_i$</span> and <span>$d_i$</span> the birth and death rates of  agent <span>$i$</span>. The total rate is given by the sum of all individual rates <span>$R(t) = \left[ \sum_i b_i(t) + d_i(t) \right]$</span>. A particular event, birth or death,  is chosen at random with a probability equal to the rate of this event divided by the total rate <span>$R$</span>.</p><p><strong>The original article by Gillsepie:</strong></p><p><a href="https://www.sciencedirect.com/science/article/pii/0021999176900413?via%3Dihub"><strong>A general method for numerically simulating the stochastic  time evolution of coupled chemical reactions</strong></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/vboussange/EvoId.jl/blob/e1dfc19397e6968f72727732d7b904a3cc4c6f8a/src/algo/Gillepsie.jl#L3">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="EvoId.CFM" href="#EvoId.CFM"><code>EvoId.CFM</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct CFM &lt;: EvoId.AbstractAlg</code></pre><p>Champagnat Ferriere Méléard algorithm described in  <a href="https://linkinghub.elsevier.com/retrieve/pii/S0040580905001632">Champagnat and Ferriere founding article</a>.  This algorithm is similar to <code>Gillepsie</code>, excepts that it runs faster for higher number of individuals.</p><p>Indeed, at every time step, only the fitness of the individual picked at random is evaluated.  In order to use it, you need to feed to the dictionary parameters  <code>p</code> a constant <code>Cbar&lt;:Real</code> that is  the upperbound of the maximum of the sum of the birth and death rates (cf article).</p><p><strong>Example</strong></p><pre><code class="language-julia">using EvoId,UnPack,Plots
myspace = (RealSpace{1,Float64}(),)
σ_b = .9;
σ_d = .7;
K0 = 1000
b(X,t) = 1.
d(X,Y,t) = gaussian(X[1],Y[1],σ_d)/K0 / gaussian(X[1],0.,σ_b)
Cbar = b([0],0.) + d([0],[0],0.)
D = (1e-2,)
mu = [.1]
NMax = 2000
tend = 1500
p = Dict{String,Any}();@pack! p = D,mu,NMax,Cbar
myagents = [Agent(myspace,(1e-2 * randn(),)) for i in 1:K0]
w0 = World(myagents,myspace,p,0.)
@time sim = run!(w0,CFM(),tend, b, d, dt_saving = 4)</code></pre><div class="admonition is-warning"><header class="admonition-header">Development</header><div class="admonition-body"><p>CFM gives an approximate time step. As of now, we do not manage to obtain qualitatively the same results as the Gillepsie algorithm.</p></div></div><p>Algorithm described in article DOI : 10.1016/j.tpb.2005.10.004</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/vboussange/EvoId.jl/blob/e1dfc19397e6968f72727732d7b904a3cc4c6f8a/src/algo/CFM.jl#L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="EvoId.WF" href="#EvoId.WF"><code>EvoId.WF</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct WF &lt;: EvoId.AbstractAlg</code></pre><p>Wright Fisher algorithm.</p><p>In the Wright Fisher process the number of agents is constant through time. It is helpful to visualize it through marbles in jar <img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Random_sampling_genetic_drift.svg" alt="alt text"/> At each time step, <span>$N$</span> agents are picked up from previous generation to reproduce.  Their number of offspring is proportional to their fitness, calculated as usual with birth and death rates. It takes thus only one time step to go trough one generation. Thus it is more suitable for numerical simulations than <code>CFM</code> or <code>Gillespie</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/vboussange/EvoId.jl/blob/e1dfc19397e6968f72727732d7b904a3cc4c6f8a/src/algo/WF.jl#L2">source</a></section></article><blockquote><p>Warning : <code>WF</code> not implemented yet</p></blockquote></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="world.html">« World</a><a class="docs-footer-nextpage" href="plots.html">Plotting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 3 December 2021 12:33">Friday 3 December 2021</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
